import{_ as s,C as i,o as t,c as n,a0 as r,b as l,w as a,a as d,E as c,a1 as u}from"./chunks/framework.B3sz4m_N.js";const C=JSON.parse('{"title":"Refactoring (AI-Assisted)","description":"Rector in CI, Cursor locally — PHP 8.x and WP/Laravel refactors with guardrails.","frontmatter":{"title":"Refactoring (AI-Assisted)","description":"Rector in CI, Cursor locally — PHP 8.x and WP/Laravel refactors with guardrails."},"headers":[],"relativePath":"reports/ai-augmented-dev-pipeline/03-refactoring.md","filePath":"reports/ai-augmented-dev-pipeline/03-refactoring.md"}'),p={name:"reports/ai-augmented-dev-pipeline/03-refactoring.md"};function P(h,e,g,m,f,R){const o=i("Mermaid");return t(),n("div",null,[e[1]||(e[1]=r('<h1 id="refactoring-ai-assisted" tabindex="-1">Refactoring (AI-Assisted) <a class="header-anchor" href="#refactoring-ai-assisted" aria-label="Permalink to &quot;Refactoring (AI-Assisted)&quot;">​</a></h1><h2 id="_1-problem-context" tabindex="-1">1. Problem Context <a class="header-anchor" href="#_1-problem-context" aria-label="Permalink to &quot;1. Problem Context&quot;">​</a></h2><p>Legacy WordPress and Laravel code needs targeted modernisation for PHP 8.x (types, named args, match) and WP/Laravel deprecations. Big-bang refactors are risky; team needs minimal, file-scoped changes and consistent rules enforced in CI.</p><h2 id="_2-ai-opportunity" tabindex="-1">2. AI Opportunity <a class="header-anchor" href="#_2-ai-opportunity" aria-label="Permalink to &quot;2. AI Opportunity&quot;">​</a></h2><p>Rector runs in CI (deterministic; no AI cost). Cursor is used locally for &quot;suggest PHP 8.x refactor&quot; on selection; developer edits and commits. Repo rules (.cursorrules) can align Cursor with WP/Laravel/ACF conventions. No autonomous refactor PRs; human always applies and commits.</p><h2 id="_3-proposed-architecture" tabindex="-1">3. Proposed Architecture <a class="header-anchor" href="#_3-proposed-architecture" aria-label="Permalink to &quot;3. Proposed Architecture&quot;">​</a></h2>',6)),(t(),l(u,null,{default:a(()=>[c(o,{id:"mermaid-18",class:"mermaid",graph:"flowchart%20TB%0A%20%20Dev%5BDeveloper%5D%20--%3E%7Cselect%20code%7C%20Cursor%5BCursor%5D%0A%20%20Cursor%20--%3E%7Csuggest%20refactor%7C%20Dev%0A%20%20Dev%20--%3E%7Cedit%2C%20commit%7C%20Branch%5BBranch%5D%0A%20%20Branch%20--%3E%20PR%5BPull%20Request%5D%0A%20%20PR%20--%3E%20Rector%5BRector%20in%20CI%5D%0A%20%20PR%20--%3E%20PHPStan%5BPHPStan%20in%20CI%5D%0A%20%20PR%20--%3E%20Tests%5BPHPUnit%2FPest%5D%0A%20%20Rector%20--%3E%20Gate%7Bpass%2Ffail%7D%0A%20%20PHPStan%20--%3E%20Gate%0A%20%20Tests%20--%3E%20Gate%0A%20%20Gate%20--%3E%7Cblock%20merge%20if%20fail%7C%20PR%0A"})]),fallback:a(()=>[...e[0]||(e[0]=[d(" Loading... ",-1)])]),_:1})),e[2]||(e[2]=r('<h2 id="_4-tooling-options-oss-vs-saas" tabindex="-1">4. Tooling Options (OSS vs SaaS) <a class="header-anchor" href="#_4-tooling-options-oss-vs-saas" aria-label="Permalink to &quot;4. Tooling Options (OSS vs SaaS)&quot;">​</a></h2><table tabindex="0"><thead><tr><th>Area</th><th>OSS</th><th>SaaS (local)</th><th>Pilot</th></tr></thead><tbody><tr><td>Rule execution</td><td>Rector (CI), PHPStan (CI)</td><td>—</td><td>Both in CI</td></tr><tr><td>Suggestions</td><td>—</td><td>Cursor</td><td>Cursor only; no Copilot at £200</td></tr></tbody></table><p>Rector: PHP 8.x preset; optional WP rule set after baseline is green. PHPStan: WordPress stubs, Laravel plugin; level 0 initially, then raise in dedicated PRs.</p><h2 id="_5-guardrails-controls" tabindex="-1">5. Guardrails &amp; Controls <a class="header-anchor" href="#_5-guardrails-controls" aria-label="Permalink to &quot;5. Guardrails &amp; Controls&quot;">​</a></h2><ul><li><strong>CI:</strong> Rector runs on every PR (or scoped paths); full test run required. No Rector-only mass PR without agreement; refactor in small PRs.</li><li><strong>Cursor:</strong> No client data in prompts; no file &gt;500 lines or paste &gt;8k chars (.cursorrules). &quot;Heavy&quot; requests capped (e.g. 25/user/week at £200).</li><li><strong>Reversibility:</strong> Revert workflow to remove Rector; or exclude paths in config. Cursor use is policy-based; no pipeline dependency.</li></ul><h2 id="_6-failure-modes" tabindex="-1">6. Failure Modes <a class="header-anchor" href="#_6-failure-modes" aria-label="Permalink to &quot;6. Failure Modes&quot;">​</a></h2><ul><li><strong>Rector rule breaks build or behaviour:</strong> Run on branch first; require CI green including tests; version Rector and rule set; &quot;Rector PRs need extra review&quot; (Dev Lead).</li><li><strong>Rector vs WP/Laravel versions:</strong> Rule sets can conflict with specific WP/plugin versions. Use preset first; add WP rules only after PHP 8.x set is green. Separate jobs or matrix for WP vs Laravel if monorepo.</li><li><strong>Baseline creep:</strong> PHPStan baseline or Rector exclusions grow. Mitigation: quarterly &quot;reduce baseline&quot; task; track baseline size (Dev Lead).</li></ul><h2 id="_7-kpis" tabindex="-1">7. KPIs <a class="header-anchor" href="#_7-kpis" aria-label="Permalink to &quot;7. KPIs&quot;">​</a></h2><ul><li><strong>Regression rate:</strong> No increase (or reduce) after refactor PRs.</li><li><strong>CI pass rate:</strong> No sustained red on main from Rector/PHPStan.</li></ul><p>Refactor-specific KPI (e.g. &quot;N files modernised&quot;) is optional; primary signal is regression rate and CI health.</p><h2 id="_8-actionable-next-steps" tabindex="-1">8. Actionable Next Steps <a class="header-anchor" href="#_8-actionable-next-steps" aria-label="Permalink to &quot;8. Actionable Next Steps&quot;">​</a></h2><ol><li>Add Rector to CI with PHP 8.x preset; scope to relevant paths (WP/Laravel lead).</li><li>Add .cursorrules: no client data; prefer small selection; WP/Laravel conventions optional.</li><li>Document &quot;Rector PRs need extra review&quot; in CONTRIBUTING or team guide.</li><li>Plan one refactor/migration run (PHP 8.x or WP upgrade) in weeks 4–6; document time and issues.</li></ol>',12))])}const b=s(p,[["render",P]]);export{C as __pageData,b as default};
